<!doctype html>
<html prefix="og: http://ogp.me/ns#" lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>M</title>
        <meta name="description" content="Martin's photo website - photography of nature, architecture, people.">

        <meta property="og:type" content="website" />
        <meta property="og:title" content="M Photo" />
        <meta property="og:description" content="Photography of nature, architecture, people." />
        <meta property="og:url" content="http://martinkz.eu/photo/" />
        <meta property="og:image" content="http://martinkz.eu/photo/assets/m-logo_fb.png" />

        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
        
        <link href='http://fonts.googleapis.com/css?family=Roboto:100,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="css/main.css">
        
        <!--[if lt IE 9]>
            <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
            <script>window.html5 || document.write('<script src="assets/html5shiv.js"><\/script>')</script> 
        <![endif]-->
    </head>
    <body>

        <nav role="navigation">
            <a id="m-logo" href="index.html" class="m-logo" title="Home">
                <img class="" src="assets/logo-m.png" alt="M Photography Logo"></a>
            
            <button id="js-hamburger" class="hamburger" aria-label="Open Menu" aria-controls="main-nav" aria-expanded="false">
                <div class="hamburger__inner"></div>
            </button>
            
            <div id="main-nav" class="modal" role="dialog" aria-label="Main Menu">
                <div class="modal__inner">
                    <a data-menu-cat="street" class="menu_item js-menu-item" href="#">Street</a>
                    <a data-menu-cat="arch" class="menu_item js-menu-item" href="#">Architecture</a>
                    <a data-menu-cat="nature" class="menu_item js-menu-item" href="#">Nature</a>
                    <a data-menu-cat="people" class="menu_item js-menu-item" href="#">People</a>
                </div>
            </div>
        </nav>
        
        <div class="bg-main-vid">
        <!-- autoplay -->
            <video id="bgvid"  loop poster="assets/poster.jpg" aria-hidden="true">
                <source src="assets/bgvid.webm" type="video/webm">
                <source src="assets/bgvid.mp4" type="video/mp4">
            </video>
        </div>
        
        <main role="main">

            <div id="js-photo-large-box" class="photo-large-box" href="#" tabindex="0" aria-label="photograph">
                <img id="js-photo-large" src="" alt="">
            </div>
            
            <section id="js-photo-section" class="photo-section hidden">
                
                <h2 id="js-cat-title" class="cat-title"></h2>
                
                <div class="photo-box hidden">
                    <div class="photo-box__inner">
                        <a class="photo-link js-photo-link" href="img-large/DSC00343-2.jpg">
                            <img data-cat="arch" src="" alt="Tsarevets Castle">
                        </a>
                        <a class="map-location js-map-location" target="_blank" href="https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446"></a>
                    </div>
                    <h2 class="photo-title color--tsarevets">Tsarevets Castle</h2>
                </div>  

                <!-- Street -->

                <div class="photo-box hidden">
                    <div class="photo-box__inner">
                        <a class="photo-link js-photo-link" href="img-large/DSC00349.jpg">
                            <img data-cat="street" src="" alt="Black Street Cat">
                        </a>
                    </div>
                    <h2 class="photo-title color--cat">Black Street Cat</h2>
                </div>
 
                

            </section>

        </main>

<!--         <script id="js-cardTemplate" type="text/template">
            <div class="photo-box hidden">
                <div class="photo-box__inner">
                    <a class="photo-link js-photo-link" href="{link}">
                        <img data-cat="{cat}" src="" alt="{altText}">
                    </a>
                    <a class="map-location js-map-location" target="_blank" href="{location}"></a>
                </div>
                <h2 class="photo-title {cssClass}">{title}</h2>
            </div>
        </script> -->
		
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="assets/jquery-2.2.3.min.js"><\/script>')</script>

		
        <script>
        $(document).ready(function()
        {

            // INIT STUFF

            $('#m-logo').attr('tabindex', '-1');

            setTimeout(function(){ 
                $('.bg-main-vid').addClass('bg-main-vid--visible'); 
            }, 0);

            var bgvid = document.getElementsByTagName("video")[0];
            // bgvid.play();

            // MAIN MENU ( MODAL / HAMBURGER FUNCTIONALITY )

            var gallery_active = false;
            var menu_active = false;
            
            var toggleMenuFunctionality = function()
            {
                $('#js-hamburger').toggleClass('hamburger--open');
                $('.modal').toggleClass('modal--visible');
                
                menu_active = $("#js-hamburger").hasClass('hamburger--open');
                
                if(menu_active) // opening menu
                { 
                    $('#js-hamburger').attr('aria-label', 'Close Menu');
                    $('#js-hamburger').attr('aria-expanded', 'true');
                    $('#m-logo').addClass('m-logo--in_header');
                    $('#m-logo').attr('tabindex', '0');
                    $('.bg-main-vid').addClass('hidden');
                    $('.photo-section').addClass('hidden');
                    bgvid.pause();
                } 
                else // closing menu
                {
                    $('#js-hamburger').attr('aria-label', 'Open Menu');
                    $('#js-hamburger').attr('aria-expanded', 'false');
                    if(gallery_active){
                        $('.photo-section').removeClass('hidden'); 
                    }
                    else 
                    {
                        $('.photo-section').addClass('hidden');
                        $('#m-logo').removeClass('m-logo--in_header');
                        $('#m-logo').attr('tabindex', '-1');
                        $('.bg-main-vid').removeClass('hidden');
                        bgvid.play();
                    }
                }
            }
            
            $('#js-hamburger').click(function(e) {
                toggleMenuFunctionality();
                // fadeOut first checks whether the element is hidden to avoid unnecessary DOM manipulation
                $('#js-photo-large-box').fadeOut(200); 
            });

            //var img_loaded = {};
            
            $('.js-menu-item').click(function(e) 
            {
                e.preventDefault();
                var s_cat = $(this).attr('data-menu-cat');
                gallery_active = true;
                toggleMenuFunctionality();
                
                photoGallery.render(s_cat); 

                $('.photo-box:not(.hidden):first .js-photo-link').focus();
                $('.bg-main-vid').addClass('hidden');
                $('#js-cat-title').text( $(this).text() );
            });

            // HOME LINK
            
            $('#m-logo').click(function(e) 
            {
                e.preventDefault();
                gallery_active = false;
                $('#m-logo').removeClass('m-logo--in_header');
                $('#m-logo').attr('tabindex', '-1');
                if(menu_active) toggleMenuFunctionality();
                $('.bg-main-vid').removeClass('hidden');
                $('.photo-box').addClass('hidden');
                $('.photo-section').addClass('hidden');
                $('#js-photo-large-box').fadeOut(200);
                bgvid.play();
            });

            // TAB KEY FUNCTIONALITY

            var tab_items = '#js-hamburger, #m-logo, .js-menu-item, .js-photo-link, .js-map-location, #js-photo-large-box';

            $(tab_items).keyup(function (e) {
                if ((e.keyCode || e.which) == 9) $(this).addClass('has-tab-focus');
            });

            $(tab_items).blur(function() {
                $(this).removeClass('has-tab-focus');
            });
            
            // GALLERY FUNCTIONALITY

            var photoData = {
                'arch' : [
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    {
                        filename: "DSC00343-2.jpg",
                        location: "https://www.google.com/maps/place/Tsarevets/@43.0837812,25.6520446,15z/data=!4m5!3m4!1s0x0:0x9a3dd95d468c59c4!8m2!3d43.0837812!4d25.6520446",
                        title: "Tsarevets Castle",
                        altText: "",
                        cssClass: "color--tsarevets"
                    },
                    
                    // ,
                    // {
                    //     filename: "",
                    //     location: "",
                    //     title: "",
                    //     altText: "",
                    //     cssClass: ""
                    // }
                ],
                'street': [
                    {
                        filename: "DSC07374.jpg",
                        location: "https://www.google.com/maps/place/Westminster+Pier/@51.5022585,-0.1249692,17z/data=!3m1!4b1!4m5!3m4!1s0x487604b5e5fa5013:0xd126c7fee870cd40!8m2!3d51.5022558!4d-0.1231811",
                        title: "New Year's Eve Fireworks",
                        altText: "",
                        cssClass: "color--nye1"
                    }
                ]
            };

            var galleryModel = {

                paths : {
                    'sm' : 'img-small/',
                    'lg' : 'img-large/' 
                },
                widths : {
                    'sm' : 800,
                    'lg' : 1920
                },
                photos : photoData,

                getCats : function() {
                    return Object.keys(this.photos);
                },
                getPhotos : function(cat) {
                    return this.photos[cat];
                },
                getPath : function(type) {
                    return this.paths[type];
                },
                getWidth : function (type) {
                    return this.widths[type];
                }
            };


            var photoCardView = {
                // Could be replaced with a mustache template some day
                buildHTML: function(card, cat) {
                    return '' +
                    '<div class="photo-box ' + (!card.title ? card.cssClass : '') + ' hidden">' + 
                    	'<div class="photo-box__inner">' + 
                    		'<a class="photo-link js-photo-link" href="' + galleryModel.getPath('lg') + card.filename + '">' + 
                                // to remove data-cat later if not needed
                    			'<img data-cat="' + cat + '" src="' + galleryModel.getPath('sm') + card.filename + '" alt="' + card.altText + '">' +
                    		'</a>' + 
                    		(card.location ? '<a class="map-location js-map-location" target="_blank" href="' + card.location + '"></a>' : '') +
                    	'</div>' + 
                    	(card.title ? '<h2 class="photo-title ' + card.cssClass + '">' + card.title + '</h2>' : '') +
                    '</div>';
                }
            };

            var photoGalleryView = function(container) {

                var _cardDOMrefs = {};
                var _prevCat;

                galleryModel.getCats().forEach( function(cat) {
                    _cardDOMrefs[cat] = [];
                });

                function catExists(cat) {
                    return _cardDOMrefs.hasOwnProperty(cat);
                }

                function catLoaded(cat) {
                    return (catExists(cat) && _cardDOMrefs[cat].length > 0);
                };

                function initCards(cat) {
                    galleryModel.getPhotos(cat).forEach( function(card) {

                        var cardDOMref = $( photoCardView.buildHTML(card, cat) );
                        
                        cardDOMref.on('click', function(e) {
                            e.preventDefault();
                            lightbox.show(card);
                        });

                        cardDOMref.find('.js-map-location').on('click', function(e){
                            e.stopPropagation();
                        })

                        _cardDOMrefs[cat].push(cardDOMref);
                    });

                     $(container).append(_cardDOMrefs[cat]);
                     console.log(cat);
                };

                this.render = function(newCat) {

                    if(_prevCat && _prevCat !== newCat) {
                        _cardDOMrefs[_prevCat].forEach( function(card) {
                            card.addClass('hidden');
                        });
                    }

                    if( !catExists(newCat) ) return;

                    if( !catLoaded(newCat) ) initCards(newCat);

                    _cardDOMrefs[newCat].forEach( function(card) {
                        card.removeClass('hidden');
                    })

                    _prevCat = newCat;
                }
            };

            var photoGallery = new photoGalleryView('#js-photo-section');


            var photoLightbox = function(el) {

                var cur_scroll;
                var container = $(el);
                var image = $(el + ' img');

                container.hide();

                this.show = function(card) {
                    var srcSet = galleryModel.getPath('lg') + card.filename + ' ' + galleryModel.getWidth('lg') + 'w, ' +
                                 galleryModel.getPath('sm') + card.filename + ' ' + galleryModel.getWidth('sm') + 'w';

                    image.attr('srcset', srcSet);
                    image.attr('src', galleryModel.getPath('lg') + card.filename);
                    container.fadeIn(200);
                    container.focus();

                    cur_scroll = $(document).scrollTop();

                    // needs refactoring
                    $('.photo-section').addClass('hidden');
                                  
                    if(history.state===null || history.state.cur_page!="photo") { 
                        history.pushState({cur_page: "photo"}, null, null);
                    }
                }

                this.hide = function() {
                    container.fadeOut(200, function(){
                        image.attr('src', '');
                        image.attr('srcset', '');
                    });
                    
                    $('.photo-section').removeClass('hidden');

                    $(document).scrollTop(cur_scroll);
                }

                var that = this;

                container.on('click', function(e) {
                    that.hide();
                });

                container.on('keyup', function(e) {
                    if (e.keyCode == 27) lightbox.hide();
                });
                
                window.addEventListener("popstate", function(event) {
                    lightbox.hide();
                });
            }

            var lightbox = new photoLightbox('#js-photo-large-box');
            
        });
        </script>
        
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-77805584-1', 'auto');
          ga('send', 'pageview');
        </script>

    </body>
</html>
